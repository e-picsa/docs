# Device Testing

### Getting Started

The guide below assumes some knowledge or running android projects locally using Android Studio.

As a minimum you will need [Android Studio](https://developer.android.com/studio) installed, and a virtual or physical device connected.
More information can be found in the [Android Studio Documentation](https://developer.android.com/studio/run)

You will also need to populate a relevant `google-services.json` file, available from project admin.

### Running on a device

To run on a device with live-reload first configure a local server to connect
You will need to determine your local adapter IP, uncomment and replace config in
`apps\picsa-apps\extension-app-native\capacitor.config.ts`

```ts
/** Uncomment and replace with local ip to serve live-reload */

// url: 'http://192.168.50.67:4200',
```

(on windows you can check your ip via `ip config` and look for `IPv4` address for your internet adapter)

Sync the changes to capacitor via the project build script.

```sh
yarn nx run picsa-apps-extension-app-native:build
```

Start the local server via the `external` configuration defined in `apps\picsa-apps\extension-app\project.json`

```sh
yarn nx run picsa-apps-extension-app:serve --configuration=external
```

Run the app from android studio either on an emulator or physical device

The app should live reload both on local network and device

### Inspecting Logs

Logs will appear in Android Studio logcat, or can be viewed in google chrome using the device inspector

`chrome://inspect/#devices`

![](./images/chrome-device-inspector.png)

Clicking on _inspect_ will launch devtools with access to full console logs

![](./images/chrome-device-inspector-2.png)

### Troubleshooting

Main common issues are outlined in the Capacitor Android Documentation:
https://capacitorjs.com/docs/android

There is also a dedicated troubleshooting page available at:
https://capacitorjs.com/docs/android/troubleshooting

A few other specific issues are outlined below:

#### Webcomponents

There may be issue bundling webcomponents when running on device server.
The current workaround is simply to temporarily disable the custom elements, by commenting out the `defineCustomElements` declarations

```ts {4,8} showLineNumbers filename="libs/webcomponents-ngx/src/lib/webcomponents-ngx.module.ts"
import { CommonModule } from "@angular/common";
import { NgModule } from "@angular/core";
// Import and register all custom elements for the module
// import { defineCustomElements } from '@picsa/webcomponents/loader';

import { DIRECTIVES } from "./generated";

// defineCustomElements(window);

@NgModule({
  imports: [CommonModule],
  declarations: [...DIRECTIVES],
  exports: [...DIRECTIVES],
})
export class WebcomponentsNgxModule {}
```
